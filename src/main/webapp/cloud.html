<!DOCTYPE html>
<html>

<script src="resources/js/d3.v3.min.js"></script>
<script src="resources/js/jquery-2.1.0.js"></script>
<script src="resources/bootstrap/js/bootstrap.min.js"></script>
<script src="resources/jquery-ui/jquery-ui.js"></script>
<script src="resources/js/jstree/src/jstree.js"></script>
<script src="resources/js/jstree/src/jstree.checkbox.js"></script>
<link href="resources/css/dyn-lod.css" rel="stylesheet"></link>

<link rel="stylesheet"
	href="resources/js/jstree/dist/themes/default/style.min.css" />
<link href="resources/bootstrap/css/bootstrap.min.css" rel="stylesheet"></link>
<link href="resources/bootstrap/css/bootstrap-theme.min.css"
	rel="stylesheet"></link>

<script src="resources/js/dyn-lod.js"></script>
<style>


circle.node {
  fill: lightsteelblue;
  stroke: #555;
  stroke-width: 3px;
}
circle.leaf {
  stroke: #fff;
  stroke-width: 1.5px;
}
path.hull {
  fill: lightsteelblue;
  fill-opacity: 0.3;
}
line.link {
  stroke: #333;
  stroke-opacity: 0.5;
}



path.link {
	fill: none;
	stroke: #666;
	stroke-width: 1.5px;
}

circle {
	fill: #ccc;
	stroke: #fff;
	stroke-width: 1.5px;
}

text {
	fill: #000;
	font: 10px sans-serif;
	pointer-events: none;
}
div.tooltip2 {
  position: absolute;	
  width: 100px;	
  height: 28px;		
  padding: 2px;	
  font: 12px sans-serif;	
  background: lightsteelblue;	
  border: 0px;					
  border-radius: 8px;
 /*  pointer-events: none;	This line needs to be removed */
}

.container
{
    display:table;
    width: 100%;
    margin-top: -50px;
    padding-top: 50px;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
}
header
{
    height: 50px;
}

@media (min-width:992px) {
    .row {
        position: relative;
    }
    .col-md-3 {
        position: absolute;
        height: 100%;
        max-height: 100%;
    }
    .col-md-9 {
        margin-left: 25%; /*Or float:right;*/
   display: table-cell;
}
</style>
<script src="resources/js/dyn-lod.js"></script>

<body>
	<script>
		$(function() {
			$("#menu").load("menu.html");
		});
	</script>

	<div id="menu"></div>
<div class="container" style=" height:100%;">



		<div class="panel panel-default">
				<div class="panel-heading">
					<div class="panel-title"></div>
					<img alt="" style="float: right; margin-top: 40px"
						src="http://aksw.org/extensions/site/sites//local/images/logo-aksw.png">
					<div class="pull-right"></div>
				</div>
				<div class="panel-body">



		<div class="page-header">
			<h2>LOD-Diagram</h2>
		</div>

		<div class="row">
			<div class="col-md-3">
				<div>
					<button class="btn btn-primary " id="filter" style="margin-top: 0px" onclick="submitMe()">Submit</button> 
					<!-- Button trigger modal -->
					<!-- button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModal">Options</button -->

					<div>
					<!-- div style="float: right; margin-right: 30px">
						Granularity level: <input type="number" id="level" name="income" value="1" style="margin-left:10px; width:40px">
					</div -->
						<div class="checkbox">
							 <label><input type="checkbox" name="ontologies" value="ontologies" id="ontologies">Show Ontologies </label>
						</div>
						<div class="checkbox">
							<label><input type="checkbox" name="distributions"  value="distributions" id="distributions">Show Distributions Links</label>
						</div>
					</div>
					
					
					<img id="loading_gif" alt="" src="resources/loading.gif" style="display: none; ">
				</div>
				<div style="overflow-y:scroll; min-height:95%; max-height:95%; margin-top:20px" >
					<div id="tree"></div>

				</div>

			</div>
			<div class="col-md-9">
				<div
					style="width: 760px; height: 670px; border: 1px solid #d8d8d8; margin-top: 20px; margin-right: 50px">
					<div id="diagram"
						style="margin-top: 10px; margin-right: 10px; margin-left: 10px;">

					</div>
				</div>
			</div>
		</div>
	</div>
	
	</div>
</div>


</body>
<script type="text/javascript">


(function ($, undefined) {
    "use strict";
    var img = document.createElement('IMG');
    img.type = 'checkbox';
    img.title = "Select or deselect child nodes"
    img.src = "resources/img/Tree_Node_Path.PNG";
    img.className = "jstree-markChildren dataSelect";

    $.jstree.defaults.markChildren = $.noop;
    $.jstree.plugins.markChildren = function (options, parent) {
        this.bind = function () {
            parent.bind.call(this);
            this.element
                .on("click.jstree", ".jstree-markChildren", $.proxy(function (e) {
                        e.stopImmediatePropagation();
                        this.settings.markChildren.call(this, this.get_node(e.target));
                        uncheck(this.get_node(e.target));
                    }, this));
        };
        this.teardown = function () {
            if(this.settings.markChildren) {
                this.element.find(".jstree-markChildren").remove();
            }
            parent.teardown.call(this);
        };
        this.redraw_node = function(obj, deep, callback) {
            obj = parent.redraw_node.call(this, obj, deep, callback);
            if(obj) {
                var tmp = img.cloneNode(true);
                obj.insertBefore(tmp, obj.childNodes[2]);
            }
            return obj;
        };
    };
})(jQuery);


$('#myModal').on('shown.bs.modal', function () {
	  $('#myInput').focus()
	})

$.post("ResourceTree", function(data) {
	$('#tree').jstree({
		"core" : {"data": data,
			 'animation' : 0,
			 "themes":{
		            "icons":false
		        }
			 } ,
			"checkbox" : {
			 "three_state": false,
			 "real_checkboxes" : true ,
			 "cascade" : "down" 
		},
		"plugins" : [ "themes", "html_data", "checkbox", "ui", "markChildren" ]
	});
	

}, 'json');
function uncheck(a){
	node = $("#tree").jstree("get_node", (a)); 

	   var roots = $('#tree').jstree(true).get_children_dom(node);
	    roots.each(function(x, k) { 
	    	var myimg = k.getElementsByTagName('img')[0];
			
	    	console.log(myimg)
	    	if(myimg.classList.contains("dataSelect")){
	    		$("#tree").jstree("deselect_node", ("#"+k.id)); 
	    		$(myimg).removeClass('dataSelect');
	    		$(myimg).addClass('dataDeselect');
	    	}
	    	else{
	    		$("#tree").jstree("select_node", ("#"+k.id)); 
	    		$(myimg).removeClass('dataDeselect');
	    		$(myimg).addClass('dataSelect');
	    	}
	    		
	  	});

}
	function submitMe() {
	var level = $("#level").val();
		var result = "";
	$("#loading_gif").show();
	$("#filter").prop('disabled', true);
	
	$('#tree').jstree('get_checked').forEach(function(l) {
		if(isValidURL(l))
			result = result + l + "&dataset="; 
	});
		if (result != "") {
		result = result.substring(0, result.length - 9);
	}
	
	// get options
	if($("#distributions").is(":checked"))
		result=result+"&showDistributions=true"
	if($("#ontologies").is(":checked"))
		result=result+"&showOntologies=true"	

	result = result + "&level="+level;
		
	makeGraph(result);
	
}

function isValidURL(url){
    var RegExp = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;
	    if(RegExp.test(url)){
        return true;
    }else{
        return false;
    }
} 	
	
</script>
</html>
